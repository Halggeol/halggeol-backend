<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.halggeol.backend.products.mapper.ProductDetailMapper">

<!--  예금  -->
  <resultMap id="depositDetailResponseDTOMap" type="com.halggeol.backend.products.dto.DepositDetailResponseDTO">
    <id property="id" column="d_id"/> <result property="name" column="d_name"/>
    <result property="rate" column="d_rate"/>
    <result property="primeRate" column="d_prime_rate"/>
    <result property="joinWay" column="d_join_way"/>
    <result property="endDate" column="d_end_date"/>
    <result property="maxLimit" column="d_max_limit"/>
    <result property="joinMember" column="d_join_member"/>
    <result property="joinDeny" column="d_join_deny"/>
    <result property="bonusCondition" column="d_bonus_condition"/>
    <result property="saveTerm" column="d_save_term"/>
    <result property="minimumCost" column="d_minimum_cost"/>
    <result property="company" column="d_company"/>
    <result property="score" column="d_score"/>
    <result property="risk" column="d_risk"/>
    <result property="regLink" column="d_reg_link"/>
    <result property="caution" column="d_caution"/>
    <result property="viewCnt" column="d_view_cnt"/>
    <result property="scrapCnt" column="d_scrap_cnt"/>
    <result property="regretCnt" column="d_regret_cnt"/>
    <result property="algoCode" column="d_algo_code"/>

    <result property="matchScore" column="pd_match_score"/>
    <result property="advantage" column="pd_advantage"/>
    <result property="disadvantage" column="pd_disadvantage"/>
  </resultMap>

  <select id="selectDepositDetailById" resultMap="depositDetailResponseDTOMap">
    SELECT
      d.id AS d_id,
      d.name AS d_name,
      d.rate AS d_rate,
      d.prime_rate AS d_prime_rate,
      d.join_way AS d_join_way,
      d.end_date AS d_end_date,
      d.max_limit AS d_max_limit,
      d.join_member AS d_join_member,
      d.join_deny AS d_join_deny,
      d.bonus_condition AS d_bonus_condition,
      d.save_term AS d_save_term,
      d.minimum_cost AS d_minimum_cost,
      d.company AS d_company,
      d.score AS d_score,
      d.risk AS d_risk,
      d.reg_link AS d_reg_link,
      d.caution AS d_caution,
      d.view_cnt AS d_view_cnt,
      d.scrap_cnt AS d_scrap_cnt,
      d.regret_cnt AS d_regret_cnt,
      d.algo_code AS d_algo_code,

      pd.match_score AS pd_match_score,
      pd.advantage AS pd_advantage,
      pd.disadvantage AS pd_disadvantage
    FROM
      deposit d
        JOIN
      users u ON u.id = #{userId}
        LEFT JOIN
      personalized_description pd ON u.algo_code = pd.algo_code AND d.id = pd.product_id
    WHERE
      d.id = #{depositId} AND d.id LIKE 'D%'
  </select>

  <!-- 적금 -->
  <resultMap id="savingsDetailResponseDTOMap" type="com.halggeol.backend.products.dto.SavingsDetailResponseDTO">
    <id property="id" column="s_id"/>
    <result property="name" column="s_name"/>
    <result property="rate" column="s_rate"/>
    <result property="primeRate" column="s_prime_rate"/>
    <result property="joinWay" column="s_join_way"/>
    <result property="endDate" column="s_end_date"/>
    <result property="maxLimit" column="s_max_limit"/>
    <result property="joinMember" column="s_join_member"/>
    <result property="joinDeny" column="s_join_deny"/>
    <result property="bonusCondition" column="s_bonus_condition"/>
    <result property="saveTerm" column="s_save_term"/>
    <result property="rateType" column="s_rate_type"/>
    <result property="saveType" column="s_save_type"/>
    <result property="company" column="s_company"/>
    <result property="score" column="s_score"/>
    <result property="risk" column="s_risk"/>
    <result property="regLink" column="s_reg_link"/>
    <result property="caution" column="s_caution"/>
    <result property="viewCnt" column="s_view_cnt"/>
    <result property="scrapCnt" column="s_scrap_cnt"/>
    <result property="regretCnt" column="s_regret_cnt"/>
    <result property="matchScore" column="pd_match_score"/>
    <result property="advantage" column="pd_advantage"/>
    <result property="disadvantage" column="pd_disadvantage"/>
  </resultMap>
  <select id="selectSavingsDetailById" resultMap="savingsDetailResponseDTOMap">
    SELECT
      s.id AS s_id,
      s.name AS s_name,
      s.rate AS s_rate,
      s.prime_rate AS s_prime_rate,
      s.join_way AS s_join_way,
      s.end_date AS s_end_date,
      s.max_limit AS s_max_limit,
      s.join_member AS s_join_member,
      s.join_deny AS s_join_deny,
      s.bonus_condition AS s_bonus_condition,
      s.save_term AS s_save_term,
      s.rate_type AS s_rate_type,
      s.save_type AS s_save_type,
      s.company AS s_company,
      s.score AS s_score,
      s.risk AS s_risk,
      s.reg_link AS s_reg_link,
      s.caution AS s_caution,
      s.view_cnt AS s_view_cnt,
      s.scrap_cnt AS s_scrap_cnt,
      s.regret_cnt AS s_regret_cnt,

      pd.match_score AS pd_match_score,
      pd.advantage AS pd_advantage,
      pd.disadvantage AS pd_disadvantage
    FROM
      savings s
        JOIN
      users u ON u.id = #{userId}
        LEFT JOIN
      personalized_description pd ON u.algo_code = pd.algo_code AND s.id = pd.product_id

    WHERE
      s.id = #{savingsId} AND s.id LIKE 'S%'
  </select>

  <!-- 펀드 -->
  <resultMap id="fundDetailResponseDTOMap" type="com.halggeol.backend.products.dto.FundDetailResponseDTO">
    <id property="id" column="f_id"/>
    <result property="name" column="f_name"/>
    <result property="rate" column="f_rate"/>
    <result property="fundPrice" column="f_fund_price"/>
    <result property="fundPriceMovement" column="f_fund_price_movement"/>
    <result property="TER" column="f_ter"/> <result property="category" column="f_category"/>
    <result property="theme" column="f_theme"/>
    <result property="investmentWarningGrade" column="f_investment_warning_grade"/>
    <result property="upfrontFee" column="f_upfront_fee"/>
    <result property="managementFee" column="f_management_fee"/>
    <result property="minimumCost" column="f_minimum_cost"/>
    <result property="target" column="f_target"/>
    <result property="investmentType" column="f_investment_type"/>
    <result property="company" column="f_company"/>
    <result property="score" column="f_score"/>
    <result property="risk" column="f_risk"/>
    <result property="regLink" column="f_reg_link"/> <result property="caution" column="f_caution"/>
    <result property="viewCnt" column="f_view_cnt"/>
    <result property="scrapCnt" column="f_scrap_cnt"/>
    <result property="regretCnt" column="f_regret_cnt"/>

    <result property="matchScore" column="pd_match_score"/>
    <result property="advantage" column="pd_advantage"/>
    <result property="disadvantage" column="pd_disadvantage"/>
  </resultMap>

  <select id="selectFundDetailById" resultMap="fundDetailResponseDTOMap">
    SELECT
      f.id AS f_id,
      f.name AS f_name,
      f.rate AS f_rate,
      f.fund_price AS f_fund_price,
      f.fund_price_movement AS f_fund_price_movement,
      f.ter AS f_ter,
      f.category AS f_category,
      f.theme AS f_theme,
      f.investment_warning_grade AS f_investment_warning_grade,
      f.upfront_fee AS f_upfront_fee,
      f.management_fee AS f_management_fee,
      f.minimum_cost AS f_minimum_cost,
      f.target AS f_target,
      f.investment_type AS f_investment_type,
      f.company AS f_company,
      f.score AS f_score,
      f.risk AS f_risk,
      f.reg_link AS f_reg_link,
      f.caution AS f_caution,
      f.view_cnt AS f_view_cnt,
      f.scrap_cnt AS f_scrap_cnt,
      f.regret_cnt AS f_regret_cnt,

      pd.match_score AS pd_match_score,
      pd.advantage AS pd_advantage,
      pd.disadvantage AS pd_disadvantage
    FROM
      fund f
        JOIN
      users u ON u.id = #{userId}
        LEFT JOIN
      personalized_description pd ON u.algo_code = pd.algo_code AND f.id = pd.product_id
    WHERE
      f.id = #{fundId} AND f.id LIKE 'F%'
  </select>

  <!-- 외화 -->
  <resultMap id="forexDetailResponseDTOMap" type="com.halggeol.backend.products.dto.ForexDetailResponseDTO">
    <id property="id" column="f_id"/>
    <result property="name" column="f_name"/>
    <result property="rate" column="f_rate"/>
    <result property="description" column="f_description"/>
    <result property="currency" column="f_currency"/>
    <result property="regFund" column="f_reg_fund"/>
    <result property="regLimitDate" column="f_reg_limit_date"/>
    <result property="autoRenew" column="f_auto_renew"/>
    <result property="extraDeposit" column="f_extra_deposit"/>
    <result property="rateGiveWay" column="f_rate_give_way"/>
    <result property="taxRefund" column="f_tax_refund"/>
    <result property="protect" column="f_protect"/>
    <result property="company" column="f_company"/>
    <result property="score" column="f_score"/>
    <result property="risk" column="f_risk"/>
    <result property="regLink" column="f_reg_link"/>
    <result property="caution" column="f_caution"/>
    <result property="viewCnt" column="f_view_cnt"/>
    <result property="scrapCnt" column="f_scrap_cnt"/>
    <result property="regretCnt" column="f_regret_cnt"/>
    <result property="algoCode" column="f_algo_code"/>

    <result property="matchScore" column="pd_match_score"/>
    <result property="advantage" column="pd_advantage"/>
    <result property="disadvantage" column="pd_disadvantage"/>
  </resultMap>
  <select id="selectForexDetailById" resultMap="forexDetailResponseDTOMap">
    SELECT
      fx.id AS f_id,
      fx.name AS f_name,
      fx.rate AS f_rate,
      fx.description AS f_description,
      fx.currency AS f_currency,
      fx.reg_fund AS f_reg_fund,
      fx.reg_limit_date AS f_reg_limit_date,
      fx.auto_renew AS f_auto_renew,
      fx.extra_deposit AS f_extra_deposit,
      fx.rate_give_way AS f_rate_give_way,
      fx.tax_refund AS f_tax_refund,
      fx.protect AS f_protect,
      fx.company AS f_company,
      fx.score AS f_score,
      fx.risk AS f_risk,
      fx.reg_link AS f_reg_link,
      fx.caution AS f_caution,
      fx.view_cnt AS f_view_cnt,
      fx.scrap_cnt AS f_scrap_cnt,
      fx.regret_cnt AS f_regret_cnt,

      pd.match_score AS pd_match_score,
      pd.advantage AS pd_advantage,
      pd.disadvantage AS pd_disadvantage
    FROM
      forex fx
        JOIN
      users u ON u.id = #{userId}
        LEFT JOIN
      personalized_description pd ON u.algo_code = pd.algo_code AND fx.id = pd.product_id
    WHERE
      fx.id = #{forexId} AND fx.id LIKE 'X%'
  </select>

  <!-- 연금 -->
  <resultMap id="pensionDetailResponseDTOMap" type="com.halggeol.backend.products.dto.PensionDetailResponseDTO">
    <id property="id" column="p_id"/>
    <result property="name" column="p_name"/>
    <result property="rate" column="p_rate"/>
    <result property="pensionKind" column="p_pension_kind"/>
    <result property="pensionType" column="p_pension_type"/>
    <result property="minGuaranteeRate" column="p_min_guarantee_rate"/>
    <result property="lastYearProfitRate" column="p_last_year_profit_rate"/>
    <result property="endDate" column="p_end_date"/> <result property="company" column="p_company"/>
    <result property="score" column="p_score"/>
    <result property="risk" column="p_risk"/>
    <result property="regLink" column="p_reg_link"/>
    <result property="caution" column="p_caution"/>
    <result property="viewCnt" column="p_view_cnt"/>
    <result property="scrapCnt" column="p_scrap_cnt"/>
    <result property="regretCnt" column="p_regret_cnt"/>
    <result property="matchScore" column="pd_match_score"/>
    <result property="advantage" column="pd_advantage"/>
    <result property="disadvantage" column="pd_disadvantage"/>
  </resultMap>

  <select id="selectPensionDetailById" resultMap="pensionDetailResponseDTOMap">
    SELECT
      pn.id AS p_id,
      pn.name AS p_name,
      pn.rate AS p_rate,
      pn.pension_kind AS p_pension_kind,
      pn.pension_type AS p_pension_type,
      pn.min_guarantee_rate AS p_min_guarantee_rate,
      pn.last_year_profit_rate AS p_last_year_profit_rate,
      pn.end_date AS p_end_date,
      pn.company AS p_company,
      pn.score AS p_score,
      pn.risk AS p_risk,
      pn.reg_link AS p_reg_link,
      pn.caution AS p_caution,
      pn.view_cnt AS p_view_cnt,
      pn.scrap_cnt AS p_scrap_cnt,
      pn.regret_cnt AS p_regret_cnt,

      pd.match_score AS pd_match_score,
      pd.advantage AS pd_advantage,
      pd.disadvantage AS pd_disadvantage
    FROM
      pension pn
        JOIN
      users u ON u.id = #{userId}
        LEFT JOIN
      personalized_description pd ON u.algo_code = pd.algo_code AND pn.id = pd.product_id
    WHERE
      pn.id = #{pensionId}
  </select>

</mapper>