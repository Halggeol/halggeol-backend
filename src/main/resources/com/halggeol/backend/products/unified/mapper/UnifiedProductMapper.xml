<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.halggeol.backend.products.unified.mapper.UnifiedProductMapper">

  <!-- 전체 목록 조회 -->
  <select id="selectAllUnifiedProducts" resultType="com.halggeol.backend.products.unified.dto.UnifiedProductResponseDTO">
    SELECT
      d.id AS productId,
      d.name,
      d.company,
      '예금' AS type,
      d.min_save_term AS tag1,
      d.max_save_term AS tag2,
      NULL AS tag3,
      CAST(d.prime_rate AS CHAR) AS title,
      CAST(d.rate AS CHAR) AS subTitle
    FROM deposit d

    UNION ALL

    SELECT
      s.id AS productId,
      s.name,
      s.company,
      '적금' AS type,
      s.min_save_term AS tag1,
      s.max_save_term AS tag2,
      NULL AS tag3,
      CAST(s.prime_rate AS CHAR) AS title,
      CAST(s.rate AS CHAR) AS subTitle
    FROM savings s

    UNION ALL

    SELECT
      p.id AS productId,
      p.name,
      p.company,
      '연금' AS type,
      p.pension_type AS tag1,
      p.pension_kind AS tag2,
      p.risk AS tag3,
      CAST(
        IF(p.pension_type = TRUE, p.rate, p.last_year_profit_rate) AS CHAR
      ) AS title,
      CAST(
        IF(p.pension_type = TRUE, p.min_guarantee_rate, p.last_year_profit_rate) AS CHAR
      ) AS subTitle
    FROM pension p

    UNION ALL

    SELECT
      f.id AS productId,
      f.name,
      f.company,
      '펀드' AS type,
      f.category AS tag1,
      f.theme AS tag2,
      f.investment_warning_grade AS tag3,
      CAST(f.rate AS CHAR) AS title,
      CAST(f.fund_price_movement AS CHAR) AS subTitle
    FROM fund f

    UNION ALL

    SELECT
      fx.id AS productId,
      fx.name,
      fx.company,
      '외화' AS type,
      fx.currency AS tag1,
      NULL AS tag2,
      NULL AS tag3,
      CAST(fx.rate AS CHAR) AS title,
      CAST(fx.rate_give_way AS CHAR) AS subTitle
    FROM forex fx;

  </select>

</mapper>
