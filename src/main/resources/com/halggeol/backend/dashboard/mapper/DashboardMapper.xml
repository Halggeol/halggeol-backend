<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.halggeol.backend.dashboard.mapper">
  <select id="getAvgRegretScoreByUserId" resultType="java.lang.Double">
    SELECT
      AVG(regret_score_union.score)
    FROM (
           SELECT product1_regret_score AS score
           FROM rec_item
           WHERE user_id = #{userId} AND product1_regret_score IS NOT NULL

           UNION ALL

           SELECT product2_regret_score AS score
           FROM rec_item
           WHERE user_id = #{userId} AND product2_regret_score IS NOT NULL

           UNION ALL

           SELECT product3_regret_score AS score
           FROM rec_item
           WHERE user_id = #{userId} AND product3_regret_score IS NOT NULL

           UNION ALL

           SELECT product4_regret_score AS score
           FROM rec_item
           WHERE user_id = #{userId} AND product4_regret_score IS NOT NULL

           UNION ALL

           SELECT product5_regret_score AS score
           FROM rec_item
           WHERE user_id = #{userId} AND product5_regret_score IS NOT NULL
         ) AS regret_score_union;
    </select>
</mapper>